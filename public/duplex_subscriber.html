<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:svg="http://www.w3.org/2000/svg"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	xml:lang="en" lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link type="text/css" rel="stylesheet" href="stylesheet/application.css" />
  

  <script src="javascript/jquery-1.4.2.js"></script>
  <script type="text/ecmascript" src="javascript/duplex_subscriber.js"></script>
  <script type="text/ecmascript">
    var subscriber = null;
    var wsAddress = "ws://192.168.2.3:80/duplex_subscriber";
    var sid = "::aa";
    var messageElementId = "messages";

    window.onload = function() {
      $('.seat').each(function() {
        rid = "::"+ this.id;
        this.seat = new Seat(sid, rid, this.id);
        this.onclick = function() {
          this.seat.reserve();
          return false;
        }
      });
      
      messageSubscriber = new Subscriber(wsAddress, messageElementId, sid, "::bb");

    }
    function debug(str){
      $("#debug").append(str + "<br />");
    };
    
    var Seat = function(sid, rid, domId) {
      this.domId = domId;
      this.sid = sid;
      this.rid = rid;
      this.subscriber = new Subscriber(wsAddress, messageElementId, this.sid, this.rid, this);

      this.reserve = function() {
        //this.subscriber.ws.send("Toggled seat status, id: "+ this.domId);
        msg = '{ "request": "SEAT_RESERVATION" }'
        this.subscriber.ws.send(msg);
        
        $("#"+this.domId).addClass("unconfirmed");
      };
      
      this.confirm = function() {
        $("#"+this.domId).removeClass("unconfirmed");
        $("#"+this.domId).addClass("confirmed");
      };
      
      this.make_unavailable = function() {
        $("#"+this.domId).addClass("unavailable");
      };
    } 
  </script>

  
</head>

<body>

<h1>Interaction experiment</h1>
<p>Nothing is escaped in received content!</p>

<button onclick="messageSubscriber.sendButtonEvent(this.value);" value="value_attr in html!">Et uskalla painaa!</button>
<button onclick="document.getElementById(messageElementId).innerHTML=''">Clear messages</button>
<button onclick="document.getElementById('debug').innerHTML=''">Clear debug</button>

<fieldset>
  <legend>Debug</legend>
  <div id="debug"></div>
</fieldset>

<fieldset class="seats">
  <legend>Seats in Theatre X</legend>
    <div class="seat" id="a1"><img src="data:image/png;base64,
    iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAABGdBTUEAALGP
    C/xhBQAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9YGARc5KB0XV+IA
    AAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAF1J
    REFUGNO9zL0NglAAxPEfdLTs4BZM4DIO4C7OwQg2JoQ9LE1exdlYvBBeZ7jq
    ch9//q1uH4TLzw4d6+ErXMMcXuHWxId3KOETnnXXV6MJpcq2MLaI97CER3N0
    vr4MkhoXe0rZigAAAABJRU5ErkJggg==" alt="Red dot" /></div>
    <div class="seat" id="a2">image</div>
    <div class="seat" id="a3">from</div>
    <div class="seat" id="a4">psirp</div>
</fieldset>

<fieldset>
  <legend>Received messages</legend>
  <div id="messages"></div>
</fieldset>

</body>

</html>